<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Completed Tasks - Surveys & Tasks</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            body {
                background-color: #f5f7fa;
                color: #333;
            }

            /* Topbar */
            .topbar {
                background: white;
                padding: 15px 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                position: sticky;
                top: 0;
                z-index: 100;
            }

            .logo {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .logo h1 {
                font-size: 24px;
                color: #1e3c72;
            }

            .logo i {
                color: #4dabf7;
            }

            .user-info {
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .notification-bell {
                position: relative;
                font-size: 18px;
                color: #5a6c7d;
                cursor: pointer;
            }

            .notification-badge {
                position: absolute;
                top: -5px;
                right: -5px;
                background-color: #f03e3e;
                color: white;
                font-size: 11px;
                width: 18px;
                height: 18px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .user-profile {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .user-avatar {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background-color: #4dabf7;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
            }

            /* Main container */
            .container {
                display: flex;
                min-height: calc(100vh - 70px);
            }

            /* Sidebar */
            .sidebar {
                width: 250px;
                background: linear-gradient(180deg, #1e3c72 0%, #2a5298 100%);
                color: white;
                padding: 30px 0;
                display: flex;
                flex-direction: column;
            }

            .nav-menu {
                list-style: none;
                flex-grow: 1;
            }

            .nav-menu li {
                margin-bottom: 5px;
            }

            .nav-menu a {
                display: flex;
                align-items: center;
                padding: 15px 25px;
                color: #d0d7e7;
                text-decoration: none;
                font-size: 16px;
                font-weight: 500;
                transition: all 0.3s;
                border-left: 4px solid transparent;
            }

            .nav-menu a:hover {
                background-color: rgba(255, 255, 255, 0.08);
                color: white;
                border-left-color: #4dabf7;
            }

            .nav-menu a.active {
                background-color: rgba(77, 171, 247, 0.15);
                color: white;
                border-left-color: #4dabf7;
            }

            .nav-menu i {
                margin-right: 12px;
                font-size: 18px;
                width: 24px;
                text-align: center;
            }

            /* Main content */
            .main-content {
                flex-grow: 1;
                padding: 30px;
                overflow-y: auto;
            }

            .page-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
                padding-bottom: 15px;
                border-bottom: 1px solid #e1e5eb;
            }

            .page-header h2 {
                font-size: 28px;
                color: #1e3c72;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .page-header h2 i {
                color: #4dabf7;
            }

            /* Completion stats */
            .completion-stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 40px;
            }

            .stat-card {
                background-color: white;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                padding: 25px;
                text-align: center;
            }

            .stat-icon {
                width: 60px;
                height: 60px;
                border-radius: 50%;
                background-color: #4dabf7;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                margin: 0 auto 15px;
            }

            .stat-icon.green {
                background-color: #40c057;
            }

            .stat-icon.orange {
                background-color: #fd7e14;
            }

            .stat-icon.purple {
                background-color: #be4bdb;
            }

            .stat-value {
                font-size: 32px;
                font-weight: 700;
                color: #1e3c72;
                margin-bottom: 5px;
            }

            .stat-label {
                font-size: 14px;
                color: #6c757d;
            }

            /* Filters and search */
            .filters-bar {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
                flex-wrap: wrap;
                gap: 15px;
            }

            .search-box {
                flex-grow: 1;
                max-width: 400px;
                position: relative;
            }

            .search-box input {
                width: 100%;
                padding: 12px 15px 12px 45px;
                border: 1px solid #ddd;
                border-radius: 8px;
                font-size: 16px;
            }

            .search-box i {
                position: absolute;
                left: 15px;
                top: 50%;
                transform: translateY(-50%);
                color: #888;
            }

            .filter-options {
                display: flex;
                gap: 10px;
                flex-wrap: wrap;
            }

            .filter-btn {
                padding: 10px 20px;
                background-color: white;
                border: 1px solid #ddd;
                border-radius: 20px;
                cursor: pointer;
                display: flex;
                align-items: center;
                gap: 8px;
                font-weight: 500;
                transition: all 0.3s;
            }

            .filter-btn.active {
                background-color: #4dabf7;
                color: white;
                border-color: #4dabf7;
            }

            .filter-btn:hover:not(.active) {
                background-color: #f8f9fa;
            }

            /* Completed tasks table */
            table {
                width: 100%;
                border-collapse: collapse;
                background-color: white;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                margin-bottom: 30px;
            }

            th {
                text-align: left;
                padding: 18px 20px;
                background-color: #f8f9fa;
                color: #495057;
                font-weight: 600;
                border-bottom: 2px solid #e9ecef;
            }

            td {
                padding: 16px 20px;
                border-bottom: 1px solid #e9ecef;
                color: #5a6c7d;
            }

            tr:hover {
                background-color: #f8f9fa;
            }

            .task-name {
                font-weight: 600;
                color: #1e3c72;
            }

            .task-category {
                padding: 4px 10px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
                background-color: #e7f5ff;
                color: #1e3c72;
                display: inline-block;
            }

            .status {
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 13px;
                font-weight: 600;
            }

            .status.completed {
                background-color: #d4edda;
                color: #155724;
            }

            .status.pending {
                background-color: #fff3cd;
                color: #856404;
            }

            .status.paid {
                background-color: #cce5ff;
                color: #004085;
            }

            .rating {
                display: flex;
                align-items: center;
                gap: 5px;
            }

            .stars {
                color: #ffc107;
            }

            .amount {
                font-weight: 600;
                color: #1e3c72;
            }

            /* Monthly earnings chart */
            .earnings-chart {
                background-color: white;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                padding: 30px;
                margin-top: 40px;
            }

            /* Submit Task Section */
            .submit-task-section {
                background-color: white;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                padding: 30px;
                margin-bottom: 30px;
            }

            .submit-header {
                margin-bottom: 25px;
                border-bottom: 2px solid #f0f0f0;
                padding-bottom: 15px;
            }

            .submit-header h3 {
                color: #1e3c72;
                font-size: 20px;
                display: flex;
                align-items: center;
                gap: 10px;
                margin-bottom: 5px;
            }

            .submit-header h3 i {
                color: #4dabf7;
            }

            .submit-header p {
                color: #6c757d;
                font-size: 14px;
                margin: 0;
            }

            .submit-form {
                display: flex;
                flex-direction: column;
                gap: 20px;
            }

            .form-group {
                display: flex;
                flex-direction: column;
            }

            .form-group label {
                color: #1e3c72;
                font-weight: 600;
                margin-bottom: 8px;
                font-size: 14px;
            }

            .form-group input[type="text"],
            .form-group textarea,
            .form-group select {
                padding: 12px 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
                font-size: 14px;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                transition: border-color 0.3s;
            }

            .form-group input[type="text"]:focus,
            .form-group textarea:focus,
            .form-group select:focus {
                outline: none;
                border-color: #4dabf7;
                box-shadow: 0 0 0 3px rgba(77, 171, 247, 0.1);
            }

            .form-group textarea {
                resize: vertical;
                min-height: 100px;
            }

            .file-upload-area {
                border: 2px dashed #4dabf7;
                border-radius: 10px;
                padding: 40px 20px;
                text-align: center;
                background-color: #f8f9fa;
                cursor: pointer;
                transition: all 0.3s;
            }

            .file-upload-area:hover {
                border-color: #1e3c72;
                background-color: #e7f5ff;
            }

            .file-upload-area i {
                font-size: 36px;
                color: #4dabf7;
                margin-bottom: 10px;
            }

            .file-upload-area h4 {
                color: #1e3c72;
                margin: 10px 0 5px;
                font-size: 16px;
            }

            .file-upload-area p {
                color: #6c757d;
                margin: 5px 0;
                font-size: 14px;
            }

            .browse-btn {
                background-color: #4dabf7;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 6px;
                cursor: pointer;
                font-weight: 600;
                transition: background-color 0.3s;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                margin-top: 10px;
            }

            .browse-btn:hover {
                background-color: #1e3c72;
            }

            .file-list {
                margin-top: 15px;
            }

            .file-item {
                display: flex;
                align-items: center;
                justify-content: space-between;
                padding: 12px;
                background-color: #f8f9fa;
                border-radius: 6px;
                margin-bottom: 8px;
                font-size: 14px;
            }

            .file-item i {
                margin-right: 10px;
                color: #4dabf7;
            }

            .file-name {
                flex-grow: 1;
                color: #1e3c72;
                font-weight: 500;
            }

            .file-size {
                color: #6c757d;
                font-size: 12px;
                margin-right: 15px;
            }

            .remove-file {
                background: none;
                border: none;
                color: #f03e3e;
                cursor: pointer;
                font-size: 16px;
                transition: color 0.3s;
            }

            .remove-file:hover {
                color: #e03131;
            }

            .form-actions {
                display: flex;
                gap: 15px;
                margin-top: 20px;
            }

            .submit-btn,
            .cancel-btn {
                padding: 12px 30px;
                border: none;
                border-radius: 6px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }

            .submit-btn {
                background-color: #40c057;
                color: white;
                flex: 1;
            }

            .submit-btn:hover {
                background-color: #2f9e44;
            }

            .cancel-btn {
                background-color: #f0f0f0;
                color: #1e3c72;
                flex: 1;
            }

            .cancel-btn:hover {
                background-color: #e0e0e0;
            }

            .chart-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 25px;
            }

            .chart-header h3 {
                color: #1e3c72;
                font-size: 20px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .chart-header h3 i {
                color: #4dabf7;
            }

            .chart-bars {
                display: flex;
                align-items: flex-end;
                height: 200px;
                gap: 30px;
                padding-bottom: 20px;
                border-bottom: 1px solid #e9ecef;
                margin-bottom: 20px;
            }

            .chart-bar {
                flex: 1;
                display: flex;
                flex-direction: column;
                align-items: center;
            }

            .bar {
                width: 100%;
                background-color: #4dabf7;
                border-radius: 4px 4px 0 0;
                transition: height 0.3s;
            }

            .bar-label {
                margin-top: 10px;
                font-size: 14px;
                color: #6c757d;
            }

            .bar-value {
                margin-top: 5px;
                font-weight: 600;
                color: #1e3c72;
            }

            .chart-legend {
                display: flex;
                justify-content: center;
                gap: 30px;
                flex-wrap: wrap;
            }

            .legend-item {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .legend-color {
                width: 15px;
                height: 15px;
                border-radius: 3px;
            }

            .legend-color.blue {
                background-color: #4dabf7;
            }

            .legend-color.green {
                background-color: #40c057;
            }

            /* Pagination */
            .pagination {
                display: flex;
                justify-content: center;
                gap: 10px;
                margin-top: 30px;
            }

            .pagination a {
                padding: 8px 15px;
                border: 1px solid #dee2e6;
                border-radius: 6px;
                color: #495057;
                text-decoration: none;
            }

            .pagination a.active {
                background-color: #4dabf7;
                color: white;
                border-color: #4dabf7;
            }

            .pagination a:hover:not(.active) {
                background-color: #f8f9fa;
            }

            /* Responsive */
            @media (max-width: 992px) {
                .sidebar {
                    width: 220px;
                }

                .chart-bars {
                    gap: 15px;
                }
            }

            @media (max-width: 768px) {
                .container {
                    flex-direction: column;
                }

                .sidebar {
                    width: 100%;
                    padding: 15px 0;
                }

                .nav-menu {
                    display: flex;
                    overflow-x: auto;
                    padding: 0 15px;
                }

                .nav-menu li {
                    flex-shrink: 0;
                    margin-bottom: 0;
                }

                .nav-menu a {
                    padding: 12px 15px;
                    border-left: none;
                    border-bottom: 3px solid transparent;
                }

                .nav-menu a.active {
                    border-left: none;
                    border-bottom-color: #4dabf7;
                }

                .filters-bar {
                    flex-direction: column;
                    align-items: stretch;
                }

                .search-box {
                    max-width: 100%;
                }

                table {
                    display: block;
                    overflow-x: auto;
                }

                .chart-bars {
                    flex-wrap: wrap;
                    height: auto;
                }

                .chart-bar {
                    width: calc(25% - 15px);
                    margin-bottom: 20px;
                }

                .form-actions {
                    flex-direction: column;
                }

                .submit-btn,
                .cancel-btn {
                    width: 100%;
                }
            }

            @keyframes slideIn {
                from {
                    transform: translateX(400px);
                    opacity: 0;
                }

                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }

            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }

                to {
                    transform: translateX(400px);
                    opacity: 0;
                }
            }

            @media (max-width: 576px) {
                .chart-bar {
                    width: calc(33.33% - 15px);
                }

                .filter-options {
                    justify-content: center;
                }
            }
        </style>
    </head>

    <body>
        <!-- Topbar -->
        <div class="topbar">
            <a href="mainpage.html" class="brand">
                <i class="fas fa-feather"></i> Neon Writers
            </a>

            <div class="user-menu">
                <div class="user-info">
                    <div class="user-name" id="userName">Loading...</div>
                    <div class="user-balance" id="userBalance">KES 0</div>
                </div>
                <a href="index.html" class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>

        <!-- Main Container -->
        <div class="container">
            <!-- Sidebar -->
            <div class="sidebar">
                <ul class="nav-menu">
                    <li><a href="mainpage.html"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="surveys.html"><i class="fas fa-list-alt"></i> Surveys</a></li>
                    <li><a href="payments.html"><i class="fas fa-credit-card"></i> Payments</a></li>
                    <li><a href="my-bids.html"><i class="fas fa-gavel"></i> My Bids</a></li>
                    <li><a href="assigned-tasks.html"><i class="fas fa-clipboard-list"></i> Assigned Tasks</a></li>
                    <li><a href="completed.html" class="active"><i class="fas fa-check-circle"></i> Completed</a></li>
                    <li><a href="support.html"><i class="fas fa-headset"></i> Support</a></li>
                    <li><a href="profile.html"><i class="fas fa-user"></i> My Profile</a></li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="page-header">
                    <h2><i class="fas fa-check-circle"></i> Completed Tasks</h2>
                    <div style="font-size: 16px; color: #6c757d;">
                        Total earned: <strong id="totalEarnedDisplay">$0.00</strong>
                    </div>
                </div>

                <!-- Completion Statistics -->
                <div class="completion-stats">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-tasks"></i>
                        </div>
                        <div class="stat-value" id="totalCompletedTasks">0</div>
                        <div class="stat-label">Total Completed</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-star"></i>
                        </div>
                        <div class="stat-value" id="averageRating">0.0</div>
                        <div class="stat-label">Average Rating</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-value" id="approvalRate">0%</div>
                        <div class="stat-label">Approval Rate</div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-value" id="avgTimeSpent">0</div>
                        <div class="stat-label">Avg. Time (min)</div>
                    </div>
                </div>

                <!-- Filters and Search -->
                <div class="filters-bar">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search completed tasks...">
                    </div>

                    <div class="filter-options">
                        <button class="filter-btn active" data-filter="all">
                            <i class="fas fa-th-list"></i> All
                        </button>
                        <button class="filter-btn" data-filter="this-month">
                            <i class="fas fa-calendar-alt"></i> This Month
                        </button>
                        <button class="filter-btn" data-filter="pending">
                            <i class="fas fa-clock"></i> Pending Approval
                        </button>
                        <button class="filter-btn" data-filter="paid">
                            <i class="fas fa-dollar-sign"></i> Paid
                        </button>
                        <button class="filter-btn" data-filter="high-rated">
                            <i class="fas fa-star"></i> High Rated
                        </button>
                    </div>
                </div>

                <!-- Completed Tasks Table -->
                <table>
                    <thead>
                        <tr>
                            <th>Task Name</th>
                            <th>Category</th>
                            <th>Completed</th>
                            <th>Time Spent</th>
                            <th>Status</th>
                            <th>Rating</th>
                            <th>Earnings</th>
                        </tr>
                    </thead>
                    <tbody id="completedTableBody">
                        <!-- Tasks will be loaded dynamically -->
                    </tbody>
                </table>

                <!-- Submit Completed Task Section -->
                <div class="submit-task-section">
                    <div class="submit-header">
                        <h3><i class="fas fa-upload"></i> Submit Completed Task</h3>
                        <p>Upload your completed task files and documentation for approval</p>
                    </div>

                    <div class="submit-form">
                        <div class="form-group">
                            <label for="taskSelect">Select Task</label>
                            <select id="taskSelect" required>
                                <option value="">Choose a task to submit...</option>
                                <option value="task1">Mobile Banking Survey</option>
                                <option value="task2">E-commerce Analysis</option>
                                <option value="task3">Market Research Study</option>
                                <option value="task4">Customer Feedback Form</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="submissionNotes">Submission Notes (Optional)</label>
                            <textarea id="submissionNotes" placeholder="Add any notes about your completed task..."
                                rows="4"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Upload Files</label>
                            <div class="file-upload-area" id="uploadArea">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <h4>Drag and drop files here</h4>
                                <p>or</p>
                                <button type="button" class="browse-btn"
                                    onclick="document.getElementById('fileInput').click()">
                                    <i class="fas fa-folder-open"></i> Browse Files
                                </button>
                                <input type="file" id="fileInput" multiple hidden>
                                <p style="margin-top: 10px; font-size: 12px; color: #888;">
                                    Accepted: PDF, DOC, DOCX, XLS, XLSX, JPG, PNG (Max 10MB each)
                                </p>
                            </div>
                            <div id="fileList" class="file-list"></div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="submit-btn" id="submitBtn">
                                <i class="fas fa-check"></i> Submit Task
                            </button>
                            <button type="button" class="cancel-btn" id="cancelBtn">
                                <i class="fas fa-times"></i> Clear
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Monthly Earnings Chart -->
                <div class="earnings-chart">
                    <div class="chart-header">
                        <h3><i class="fas fa-chart-line"></i> Monthly Earnings</h3>
                        <div style="font-size: 14px; color: #6c757d;">
                            <i class="fas fa-calendar-alt"></i> <span id="chartDateRange">Jan 2023 - Jun 2023</span>
                        </div>
                    </div>

                    <div class="chart-bars" id="chartBars">
                        <!-- Chart bars will be generated dynamically -->
                    </div>

                    <div class="chart-legend">
                        <div class="legend-item">
                            <div class="legend-color blue"></div>
                            <span>Previous Months</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color green"></div>
                            <span>Current Month</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            let uploadedFiles = [];

            document.addEventListener('DOMContentLoaded', function () {
                // Load user data
                const userData = JSON.parse(localStorage.getItem('neon_writers_user') || '{}');
                const isLoggedIn = localStorage.getItem('neon_writers_logged_in') === 'true';

                if (!isLoggedIn) {
                    window.location.href = 'index.html';
                    return;
                }

                // Update user info
                document.getElementById('userName').textContent = userData.firstName || 'User';
                document.getElementById('userBalance').textContent = userData.balance ? `KES ${userData.balance}` : 'KES 0';

                // Load completed tasks
                loadCompletedTasks();

                // Setup event listeners
                document.querySelectorAll('.filter-btn').forEach(button => {
                    button.addEventListener('click', function () {
                        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        filterTasks(this.dataset.filter);
                    });
                });

                document.querySelector('.search-box input').addEventListener('input', function () {
                    searchTasks(this.value);
                });

                document.getElementById('logoutBtn').addEventListener('click', function (e) {
                    e.preventDefault();
                    localStorage.removeItem('neon_writers_logged_in');
                    window.location.href = 'index.html';
                });

                // File upload handlers
                const uploadArea = document.getElementById('uploadArea');
                const fileInput = document.getElementById('fileInput');
                const submitBtn = document.getElementById('submitBtn');
                const cancelBtn = document.getElementById('cancelBtn');

                // Drag and drop
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#1e3c72';
                    uploadArea.style.backgroundColor = '#e7f5ff';
                });

                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.style.borderColor = '#4dabf7';
                    uploadArea.style.backgroundColor = '#f8f9fa';
                });

                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.style.borderColor = '#4dabf7';
                    uploadArea.style.backgroundColor = '#f8f9fa';
                    handleFiles(e.dataTransfer.files);
                });

                fileInput.addEventListener('change', (e) => {
                    handleFiles(e.target.files);
                });

                submitBtn.addEventListener('click', submitTask);
                cancelBtn.addEventListener('click', clearForm);

                // Update chart date range to current year
                const currentYear = new Date().getFullYear();
                document.getElementById('chartDateRange').textContent = `Jan ${currentYear} - Jun ${currentYear}`;
                generateEmptyChart();
            });

            function handleFiles(files) {
                const allowedTypes = ['application/pdf', 'application/msword',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'application/vnd.ms-excel', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'image/jpeg', 'image/png'];
                const maxSize = 10 * 1024 * 1024; // 10MB

                for (let file of files) {
                    if (!allowedTypes.includes(file.type)) {
                        alert(`File type not allowed: ${file.name}`);
                        continue;
                    }
                    if (file.size > maxSize) {
                        alert(`File too large: ${file.name} (Max 10MB)`);
                        continue;
                    }

                    uploadedFiles.push(file);
                }

                displayFiles();
            }

            function displayFiles() {
                const fileList = document.getElementById('fileList');
                fileList.innerHTML = '';

                uploadedFiles.forEach((file, index) => {
                    const fileIcon = getFileIcon(file.type);
                    const fileSize = (file.size / 1024).toFixed(2);
                    const fileItem = document.createElement('div');
                    fileItem.className = 'file-item';
                    fileItem.innerHTML = `
                        <div style="display: flex; align-items: center; flex-grow: 1;">
                            <i class="fas ${fileIcon}"></i>
                            <span class="file-name">${file.name}</span>
                        </div>
                        <span class="file-size">${fileSize} KB</span>
                        <button type="button" class="remove-file" onclick="removeFile(${index})">
                            <i class="fas fa-trash"></i>
                        </button>
                    `;
                    fileList.appendChild(fileItem);
                });
            }

            function removeFile(index) {
                uploadedFiles.splice(index, 1);
                displayFiles();
            }

            function getFileIcon(fileType) {
                if (fileType.includes('pdf')) return 'fa-file-pdf';
                if (fileType.includes('word')) return 'fa-file-word';
                if (fileType.includes('excel')) return 'fa-file-excel';
                if (fileType.includes('image')) return 'fa-file-image';
                return 'fa-file';
            }

            function submitTask() {
                const taskSelect = document.getElementById('taskSelect');
                const submissionNotes = document.getElementById('submissionNotes');

                if (!taskSelect.value) {
                    alert('Please select a task to submit');
                    return;
                }

                if (uploadedFiles.length === 0) {
                    alert('Please upload at least one file');
                    return;
                }

                // Create submission object
                const submission = {
                    taskId: taskSelect.value,
                    taskName: taskSelect.options[taskSelect.selectedIndex].text,
                    notes: submissionNotes.value,
                    fileCount: uploadedFiles.length,
                    submittedDate: new Date().toLocaleDateString(),
                    submittedTime: new Date().toLocaleTimeString(),
                    status: 'pending'
                };

                // Save to localStorage
                const submissions = JSON.parse(localStorage.getItem('neon_writers_submissions') || '[]');
                submissions.push(submission);
                localStorage.setItem('neon_writers_submissions', JSON.stringify(submissions));

                // Show success message
                showToast(`Task "${submission.taskName}" submitted successfully! Our team will review your submission.`, 'success');

                // Clear form
                clearForm();
            }

            function clearForm() {
                document.getElementById('taskSelect').value = '';
                document.getElementById('submissionNotes').value = '';
                uploadedFiles = [];
                displayFiles();
                document.getElementById('fileInput').value = '';
            }

            function showToast(message, type = 'info') {
                const toast = document.createElement('div');
                toast.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#40c057' : '#4dabf7'};
                    color: white;
                    padding: 15px 20px;
                    border-radius: 8px;
                    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
                    z-index: 1000;
                    animation: slideIn 0.3s ease;
                `;
                toast.innerHTML = message;
                document.body.appendChild(toast);

                setTimeout(() => {
                    toast.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => toast.remove(), 300);
                }, 4000);
            }

            function loadCompletedTasks() {
                // Get completed tasks from localStorage or user data
                const userData = JSON.parse(localStorage.getItem('neon_writers_user') || '{}');
                const completedTasks = JSON.parse(localStorage.getItem('neon_writers_completed_tasks') || '[]');
                const userCompletedList = userData.completedList || [];

                // Use whichever source has data
                let tasks = completedTasks.length > 0 ? completedTasks : userCompletedList;

                // Calculate statistics
                const totalCompleted = tasks.length;
                const totalEarned = tasks.reduce((sum, task) => sum + (parseFloat(task.earnings) || 0), 0);
                const totalRating = tasks.reduce((sum, task) => sum + (parseFloat(task.rating) || 0), 0);
                const avgRating = totalCompleted > 0 ? (totalRating / totalCompleted).toFixed(1) : 0;
                const totalTime = tasks.reduce((sum, task) => sum + (parseInt(task.timeSpent) || 0), 0);
                const avgTime = totalCompleted > 0 ? Math.round(totalTime / totalCompleted) : 0;

                // Update statistics display
                document.getElementById('totalCompletedTasks').textContent = totalCompleted;
                document.getElementById('totalEarnedDisplay').textContent = `$${totalEarned.toFixed(2)}`;
                document.getElementById('averageRating').textContent = avgRating;
                document.getElementById('approvalRate').textContent = totalCompleted > 0 ? '100%' : '0%';
                document.getElementById('avgTimeSpent').textContent = avgTime;

                // Display tasks
                displayTasks(tasks);

                // Update chart if there are earnings
                if (totalEarned > 0) {
                    updateChartWithData(tasks);
                }
            }

            function displayTasks(tasks) {
                const tbody = document.getElementById('completedTableBody');

                if (tasks.length === 0) {
                    tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: #6c757d;">
                            <i class="fas fa-check-circle" style="font-size: 3rem; margin-bottom: 15px; display: block; color: #d0d0d0;"></i>
                            <h3 style="margin-bottom: 10px; color: #5a6c7d;">No completed tasks yet</h3>
                            <p style="color: #888; font-size: 14px;">Your completed tasks will appear here once you finish and submit them</p>
                        </td>
                    </tr>
                `;
                    return;
                }

                // Sort by completion date (newest first)
                tasks.sort((a, b) => new Date(b.completedDate || b.date) - new Date(a.completedDate || a.date));

                let html = '';
                tasks.forEach(task => {
                    const taskName = task.name || task.title || 'Unnamed Task';
                    const category = task.category || 'General';
                    const completedDate = task.completedDate || task.date || new Date().toLocaleDateString();
                    const timeSpent = task.timeSpent ? `${task.timeSpent} min` : '--';
                    const status = task.status || 'completed';
                    const rating = task.rating || '--';
                    const earnings = task.earnings ? `$${parseFloat(task.earnings).toFixed(2)}` : '$0.00';

                    let ratingStars = '';
                    if (rating !== '--') {
                        const numRating = parseFloat(rating);
                        ratingStars = `
                        <span class="stars">
                            ${getStarsHTML(numRating)}
                        </span>
                        ${numRating.toFixed(1)}
                    `;
                    } else {
                        ratingStars = '--';
                    }

                    html += `
                    <tr>
                        <td class="task-name">${taskName}</td>
                        <td><span class="task-category">${category}</span></td>
                        <td>${completedDate}</td>
                        <td>${timeSpent}</td>
                        <td><span class="status ${status}">${getStatusText(status)}</span></td>
                        <td class="rating">${ratingStars}</td>
                        <td class="amount">${earnings}</td>
                    </tr>
                `;
                });

                tbody.innerHTML = html;
            }

            function getStarsHTML(rating) {
                let stars = '';
                const fullStars = Math.floor(rating);
                const hasHalfStar = rating % 1 >= 0.5;

                for (let i = 0; i < fullStars; i++) {
                    stars += '<i class="fas fa-star"></i>';
                }

                if (hasHalfStar) {
                    stars += '<i class="fas fa-star-half-alt"></i>';
                }

                const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
                for (let i = 0; i < emptyStars; i++) {
                    stars += '<i class="far fa-star"></i>';
                }

                return stars;
            }

            function getStatusText(status) {
                const statusMap = {
                    'completed': 'Approved',
                    'pending': 'Pending Approval',
                    'paid': 'Paid',
                    'approved': 'Approved'
                };
                return statusMap[status] || status.charAt(0).toUpperCase() + status.slice(1);
            }

            function filterTasks(filterType) {
                const rows = document.querySelectorAll('#completedTableBody tr');
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();

                rows.forEach(row => {
                    if (row.cells.length === 1) return; // Skip the "no tasks" row

                    const statusCell = row.querySelector('.status');
                    const ratingCell = row.querySelector('.rating');
                    const dateCell = row.cells[2];

                    let showRow = true;

                    if (filterType === 'this-month') {
                        const dateText = dateCell.textContent;
                        if (dateText.includes('Jun') && currentYear === 2023) {
                            showRow = true;
                        } else {
                            showRow = false;
                        }
                    } else if (filterType === 'pending') {
                        showRow = statusCell.textContent.includes('Pending');
                    } else if (filterType === 'paid') {
                        showRow = statusCell.textContent.includes('Paid');
                    } else if (filterType === 'high-rated') {
                        if (ratingCell.textContent !== '--') {
                            const ratingMatch = ratingCell.textContent.match(/(\d+\.\d+)/);
                            if (ratingMatch && parseFloat(ratingMatch[1]) >= 4.0) {
                                showRow = true;
                            } else {
                                showRow = false;
                            }
                        } else {
                            showRow = false;
                        }
                    }

                    row.style.display = showRow ? '' : 'none';
                });
            }

            function searchTasks(searchTerm) {
                const rows = document.querySelectorAll('#completedTableBody tr');

                rows.forEach(row => {
                    if (row.cells.length === 1) {
                        row.style.display = searchTerm ? 'none' : '';
                        return;
                    }

                    const taskName = row.cells[0].textContent.toLowerCase();
                    const category = row.cells[1].textContent.toLowerCase();

                    if (taskName.includes(searchTerm.toLowerCase()) ||
                        category.includes(searchTerm.toLowerCase())) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                });
            }

            function generateEmptyChart() {
                const chartBars = document.getElementById('chartBars');
                const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];

                let html = '';
                months.forEach(month => {
                    html += `
                    <div class="chart-bar">
                        <div class="bar" style="height: 0%; background-color: #4dabf7;"></div>
                        <div class="bar-label">${month}</div>
                        <div class="bar-value">$0</div>
                    </div>
                `;
                });

                chartBars.innerHTML = html;
            }

            function updateChartWithData(tasks) {
                // Group earnings by month
                const monthlyEarnings = {
                    'Jan': 0, 'Feb': 0, 'Mar': 0, 'Apr': 0, 'May': 0, 'Jun': 0
                };

                tasks.forEach(task => {
                    if (task.earnings) {
                        const date = task.completedDate || task.date;
                        if (date) {
                            const month = new Date(date).toLocaleString('default', { month: 'short' });
                            if (monthlyEarnings.hasOwnProperty(month)) {
                                monthlyEarnings[month] += parseFloat(task.earnings);
                            }
                        }
                    }
                });

                // Update chart bars
                const chartBars = document.getElementById('chartBars');
                const maxEarning = Math.max(...Object.values(monthlyEarnings), 1);

                let html = '';
                Object.entries(monthlyEarnings).forEach(([month, earnings]) => {
                    const height = maxEarning > 0 ? (earnings / maxEarning * 100) : 0;
                    const isCurrentMonth = month === 'Jun'; // Example: June is current month
                    const barColor = isCurrentMonth ? '#40c057' : '#4dabf7';

                    html += `
                    <div class="chart-bar">
                        <div class="bar" style="height: ${height}%; background-color: ${barColor};"></div>
                        <div class="bar-label">${month}</div>
                        <div class="bar-value">$${earnings.toFixed(2)}</div>
                    </div>
                `;
                });

                chartBars.innerHTML = html;
            }
        </script>
    </body>

</html>