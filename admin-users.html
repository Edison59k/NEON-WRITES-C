<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Admin - Users</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <style>
            :root {
                --neon-purple: #8a2be2;
                --neon-pink: #ff00ff;
                --neon-blue: #00ffff;
                --neon-green: #39ff14;
                --dark-bg: #0a0a1a;
                --darker-bg: #050510;
                --card-bg: rgba(20, 20, 40, 0.8);
                --light-text: #ffffff;
                --muted-text: #b0b0d0;
                --gradient-primary: linear-gradient(135deg, #8a2be2, #ff00ff);
                --gradient-secondary: linear-gradient(135deg, #00ffff, #39ff14);
                --glow-purple: 0 0 15px rgba(138, 43, 226, 0.7);
                --error-color: #ff4757;
                --success-color: #2ed573;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            body {
                background: var(--dark-bg);
                color: var(--light-text);
                min-height: 100vh;
            }

            /* Neon Background */
            .neon-background {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                z-index: -1;
                overflow: hidden;
            }

            .neon-grid {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-image:
                    linear-gradient(rgba(138, 43, 226, 0.1) 1px, transparent 1px),
                    linear-gradient(90deg, rgba(138, 43, 226, 0.1) 1px, transparent 1px);
                background-size: 50px 50px;
            }

            /* Topbar */
            .topbar {
                background: rgba(10, 10, 26, 0.9);
                backdrop-filter: blur(10px);
                border-bottom: 1px solid rgba(138, 43, 226, 0.3);
                padding: 20px 40px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: sticky;
                top: 0;
                z-index: 100;
                box-shadow: var(--glow-purple);
            }

            .brand {
                font-size: 1.8rem;
                font-weight: 700;
                background: var(--gradient-primary);
                -webkit-background-clip: text;
                background-clip: text;
                color: transparent;
                display: flex;
                align-items: center;
                gap: 10px;
                text-shadow: 0 0 10px rgba(138, 43, 226, 0.5);
                text-decoration: none;
            }

            .brand i {
                font-size: 2rem;
            }

            .user-menu {
                display: flex;
                align-items: center;
                gap: 20px;
            }

            .user-info {
                text-align: right;
            }

            .user-name {
                font-weight: 600;
                font-size: 1.1rem;
            }

            .user-balance {
                color: var(--neon-green);
                font-weight: 600;
            }

            .logout-btn {
                background: rgba(255, 51, 102, 0.2);
                color: #ff3366;
                border: 1px solid rgba(255, 51, 102, 0.5);
                padding: 8px 20px;
                border-radius: 50px;
                text-decoration: none;
                font-weight: 500;
                transition: all 0.3s ease;
            }

            .logout-btn:hover {
                background: rgba(255, 51, 102, 0.4);
                transform: translateY(-2px);
            }

            /* Main container */
            .container {
                display: flex;
                min-height: calc(100vh - 80px);
            }

            /* Sidebar */
            .sidebar {
                width: 250px;
                background: rgba(10, 10, 26, 0.8);
                backdrop-filter: blur(10px);
                border-right: 1px solid rgba(138, 43, 226, 0.3);
                padding: 30px 0;
                display: flex;
                flex-direction: column;
            }

            .nav-menu {
                list-style: none;
                flex-grow: 1;
            }

            .nav-menu li {
                margin-bottom: 5px;
            }

            .nav-menu a {
                display: flex;
                align-items: center;
                padding: 15px 25px;
                color: var(--muted-text);
                text-decoration: none;
                font-size: 16px;
                font-weight: 500;
                transition: all 0.3s;
                border-left: 4px solid transparent;
            }

            .nav-menu a:hover {
                background: rgba(138, 43, 226, 0.1);
                color: var(--light-text);
                border-left-color: var(--neon-purple);
            }

            .nav-menu a.active {
                background: rgba(138, 43, 226, 0.2);
                color: var(--light-text);
                border-left-color: var(--neon-purple);
            }

            .nav-menu i {
                margin-right: 12px;
                font-size: 18px;
                width: 24px;
                text-align: center;
            }

            /* Main content */
            .main-content {
                flex-grow: 1;
                padding: 30px;
                overflow-y: auto;
            }

            .page-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
                padding-bottom: 15px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .page-header h2 {
                font-size: 28px;
                color: var(--light-text);
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .page-header h2 i {
                color: var(--neon-blue);
            }

            /* Admin Stats */
            .admin-stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 40px;
            }

            .stat-badge {
                background: var(--card-bg);
                border: 1px solid rgba(138, 43, 226, 0.2);
                border-radius: 15px;
                padding: 25px;
                text-align: center;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .stat-badge::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 4px;
                background: var(--gradient-primary);
            }

            .stat-badge:hover {
                transform: translateY(-5px);
                border-color: var(--neon-purple);
                box-shadow: var(--glow-purple);
            }

            .stat-icon {
                font-size: 2.5rem;
                margin-bottom: 15px;
                background: var(--gradient-primary);
                -webkit-background-clip: text;
                background-clip: text;
                color: transparent;
            }

            .stat-details h4 {
                font-size: 14px;
                color: var(--muted-text);
                margin-bottom: 8px;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .stat-details .value {
                font-size: 32px;
                font-weight: 700;
                color: var(--light-text);
            }

            /* Search and Filters */
            .search-section {
                background: var(--card-bg);
                border-radius: 15px;
                padding: 25px;
                margin-bottom: 30px;
                border: 1px solid rgba(138, 43, 226, 0.2);
            }

            .search-row {
                display: flex;
                gap: 15px;
                align-items: flex-end;
            }

            .search-group {
                flex: 1;
            }

            .search-group label {
                display: block;
                margin-bottom: 8px;
                color: var(--muted-text);
                font-size: 14px;
            }

            .search-input {
                width: 100%;
                padding: 12px 15px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                color: var(--light-text);
                font-size: 16px;
            }

            .btn {
                padding: 12px 25px;
                border-radius: 8px;
                border: none;
                font-size: 16px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                display: inline-flex;
                align-items: center;
                gap: 8px;
                text-decoration: none;
            }

            .btn-primary {
                background: var(--gradient-primary);
                color: white;
                box-shadow: 0 4px 20px rgba(138, 43, 226, 0.4);
            }

            .btn-primary:hover {
                transform: translateY(-3px);
                box-shadow: 0 8px 25px rgba(138, 43, 226, 0.6);
            }

            .btn-secondary {
                background: rgba(255, 255, 255, 0.1);
                color: var(--light-text);
                border: 1px solid rgba(255, 255, 255, 0.2);
            }

            .btn-secondary:hover {
                background: rgba(255, 255, 255, 0.2);
                transform: translateY(-3px);
            }

            .btn-danger {
                background: rgba(255, 71, 87, 0.2);
                color: #ff4757;
                border: 1px solid rgba(255, 71, 87, 0.5);
            }

            .btn-danger:hover {
                background: rgba(255, 71, 87, 0.4);
            }

            /* Users Table */
            .users-table-container {
                background: var(--card-bg);
                border-radius: 15px;
                border: 1px solid rgba(138, 43, 226, 0.2);
                overflow: hidden;
            }

            .table-header {
                padding: 20px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            table {
                width: 100%;
                border-collapse: collapse;
            }

            th {
                text-align: left;
                padding: 15px 20px;
                color: var(--muted-text);
                font-weight: 600;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                background: rgba(0, 0, 0, 0.2);
            }

            td {
                padding: 15px 20px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            }

            .user-avatar {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background: var(--gradient-primary);
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
                color: white;
            }

            .user-name-cell {
                display: flex;
                align-items: center;
                gap: 12px;
            }

            .user-details .name {
                font-weight: 600;
                color: var(--light-text);
            }

            .user-details .email {
                font-size: 14px;
                color: var(--muted-text);
            }

            .user-status {
                padding: 5px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
            }

            .status-active {
                background: rgba(46, 213, 115, 0.2);
                color: #2ed573;
            }

            .status-pending {
                background: rgba(255, 165, 2, 0.2);
                color: #ffa502;
            }

            .status-suspended {
                background: rgba(255, 71, 87, 0.2);
                color: #ff4757;
            }

            .user-role {
                padding: 5px 12px;
                border-radius: 20px;
                font-size: 12px;
                font-weight: 600;
                background: rgba(138, 43, 226, 0.2);
                color: var(--light-text);
            }

            .action-buttons {
                display: flex;
                gap: 8px;
            }

            .action-btn {
                padding: 6px 12px;
                border-radius: 6px;
                font-size: 14px;
                cursor: pointer;
                border: none;
                transition: all 0.3s;
            }

            .edit-btn {
                background: rgba(0, 255, 255, 0.2);
                color: var(--neon-blue);
            }

            .view-btn {
                background: rgba(57, 255, 20, 0.2);
                color: var(--neon-green);
            }

            /* Pagination */
            .pagination {
                padding: 20px;
                display: flex;
                justify-content: center;
                gap: 10px;
            }

            .page-btn {
                padding: 8px 15px;
                border-radius: 6px;
                background: rgba(255, 255, 255, 0.1);
                color: var(--light-text);
                border: none;
                cursor: pointer;
                transition: all 0.3s;
            }

            .page-btn.active {
                background: var(--gradient-primary);
                color: white;
            }

            .page-btn:hover:not(.active) {
                background: rgba(255, 255, 255, 0.2);
            }

            /* Responsive */
            @media (max-width: 768px) {
                .container {
                    flex-direction: column;
                }

                .sidebar {
                    width: 100%;
                    padding: 20px 0;
                }

                .nav-menu {
                    display: flex;
                    overflow-x: auto;
                    padding: 0 15px;
                }

                .nav-menu li {
                    flex-shrink: 0;
                    margin-bottom: 0;
                    margin-right: 10px;
                }

                .nav-menu a {
                    padding: 12px 15px;
                    border-left: none;
                    border-bottom: 3px solid transparent;
                }

                .nav-menu a.active {
                    border-left: none;
                    border-bottom-color: var(--neon-purple);
                }

                .admin-stats {
                    grid-template-columns: 1fr 1fr;
                }

                .search-row {
                    flex-direction: column;
                    align-items: stretch;
                }

                .action-buttons {
                    flex-direction: column;
                }

                table {
                    display: block;
                    overflow-x: auto;
                }

                .topbar {
                    padding: 15px 20px;
                    flex-direction: column;
                    gap: 15px;
                }

                .user-menu {
                    width: 100%;
                    justify-content: space-between;
                }
            }

            @media (max-width: 480px) {
                .admin-stats {
                    grid-template-columns: 1fr;
                }

                .main-content {
                    padding: 20px;
                }
            }
        </style>
    </head>

    <body>
        <!-- Neon Background -->
        <div class="neon-background">
            <div class="neon-grid"></div>
        </div>

        <!-- Topbar -->
        <div class="topbar">
            <a href="mainpage.html" class="brand">
                <i class="fas fa-feather"></i> Neon Writers
            </a>

            <div class="user-menu">
                <div class="user-info">
                    <div class="user-name" id="userName">Admin Panel</div>
                    <div class="user-balance" id="userBalance">Admin</div>
                </div>
                <a href="index.html" class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>

        <!-- Main Container -->
        <div class="container">
            <!-- Sidebar -->
            <div class="sidebar">
                <ul class="nav-menu">
                    <li><a href="mainpage.html"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="admin-upload.html"><i class="fas fa-upload"></i> Upload Tasks</a></li>
                    <li><a href="admin-users.html" class="active"><i class="fas fa-users"></i> Users</a></li>
                    <li><a href="admin-bids.html"><i class="fas fa-gavel"></i> Bids Management</a></li>
                    <li><a href="admin-payments.html"><i class="fas fa-credit-card"></i> Payments</a></li>
                    <li><a href="admin-reports.html"><i class="fas fa-chart-bar"></i> Reports</a></li>
                    <li><a href="admin-settings.html"><i class="fas fa-cog"></i> Settings</a></li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="page-header">
                    <h2><i class="fas fa-users"></i> Users Management</h2>
                    <div style="font-size: 16px; color: var(--muted-text);">
                        Manage all users and their permissions
                    </div>
                </div>

                <!-- Admin Statistics -->
                <div class="admin-stats">
                    <div class="stat-badge">
                        <div class="stat-icon">
                            <i class="fas fa-user-friends"></i>
                        </div>
                        <div class="stat-details">
                            <h4>Total Users</h4>
                            <div class="value" id="totalUsers">0</div>
                        </div>
                    </div>

                    <div class="stat-badge">
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-details">
                            <h4>Active Users</h4>
                            <div class="value" id="activeUsers">0</div>
                        </div>
                    </div>

                    <div class="stat-badge">
                        <div class="stat-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="stat-details">
                            <h4>Writers</h4>
                            <div class="value" id="writerUsers">0</div>
                        </div>
                    </div>

                    <div class="stat-badge">
                        <div class="stat-icon">
                            <i class="fas fa-user-clock"></i>
                        </div>
                        <div class="stat-details">
                            <h4>Pending Verification</h4>
                            <div class="value" id="pendingUsers">0</div>
                        </div>
                    </div>
                </div>

                <!-- Search and Filters -->
                <div class="search-section">
                    <div class="search-row">
                        <div class="search-group">
                            <label>Search Users</label>
                            <input type="text" class="search-input" id="searchInput"
                                placeholder="Search by name or email...">
                        </div>
                        <div class="search-group">
                            <label>User Type</label>
                            <select class="search-input" id="userTypeFilter">
                                <option value="">All Users</option>
                                <option value="writer">Writers</option>
                                <option value="admin">Admins</option>
                                <option value="client">Clients</option>
                            </select>
                        </div>
                        <div class="search-group">
                            <label>Status</label>
                            <select class="search-input" id="statusFilter">
                                <option value="">All Status</option>
                                <option value="active">Active</option>
                                <option value="pending">Pending</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="searchBtn">
                            <i class="fas fa-search"></i> Search
                        </button>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="users-table-container">
                    <div class="table-header">
                        <h3 style="color: var(--light-text);">All Users</h3>
                        <div style="display:flex; gap:8px;">
                            <button class="btn btn-secondary" id="exportUsersBtn">
                                <i class="fas fa-file-export"></i> Export Users
                            </button>
                            <button class="btn btn-danger" id="clearRecordsBtn"
                                title="Clear all stored user/payment/completed records">
                                <i class="fas fa-trash"></i> Clear Records
                            </button>
                        </div>
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Type</th>
                                <th>Status</th>
                                <th>Joined</th>
                                <th>Tasks Completed</th>
                                <th>Earnings</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTableBody">
                            <!-- Users will be populated here -->
                        </tbody>
                    </table>

                    <div class="pagination" id="pagination">
                        <!-- Pagination will be generated here -->
                    </div>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                // Check admin authentication
                checkAdminAuth();

                // Load users
                loadUsers();

                // Setup event listeners
                document.getElementById('searchBtn').addEventListener('click', loadUsers);
                document.getElementById('searchInput').addEventListener('keyup', function (e) {
                    if (e.key === 'Enter') loadUsers();
                });
                document.getElementById('exportUsersBtn').addEventListener('click', exportUsers);
                document.getElementById('logoutBtn').addEventListener('click', logout);

                // Clear stored records (users, payments, completed) on admin action
                const clearBtn = document.getElementById('clearRecordsBtn');
                if (clearBtn) {
                    clearBtn.addEventListener('click', function () {
                        const ok = confirm('This will permanently delete stored users, payments, and completed task records. Proceed?');
                        if (!ok) return;
                        try {
                            localStorage.removeItem('neon_writers_users');
                            localStorage.removeItem('neon_writers_payments');
                            localStorage.removeItem('neon_writers_completed');
                            alert('Records cleared successfully.');
                            loadUsers();
                        } catch (e) {
                            console.error('Failed to clear records', e);
                            alert('Failed to clear records. See console for details.');
                        }
                    });
                }
            });

            function checkAdminAuth() {
                const isLoggedIn = localStorage.getItem('neon_writers_logged_in') === 'true';
                if (!isLoggedIn) {
                    window.location.href = 'login.html';
                    return;
                }

                const userData = JSON.parse(localStorage.getItem('neon_writers_user') || '{}');
                const isAdmin = userData.email && (userData.email.includes('admin') || userData.isAdmin === true);

                if (!isAdmin) {
                    alert('Access Denied: Admin privileges required');
                    window.location.href = 'mainpage.html';
                    return;
                }

                document.getElementById('userName').textContent = `Admin: ${userData.firstName || 'Administrator'}`;
            }

            function loadUsers() {
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const userType = document.getElementById('userTypeFilter').value;
                const statusFilter = document.getElementById('statusFilter').value;

                // Get users from localStorage (no demo users - start clean)
                let users = JSON.parse(localStorage.getItem('neon_writers_users') || '[]');

                // Filter users
                let filteredUsers = users.filter(user => {
                    const matchesSearch = !searchTerm ||
                        user.fullName.toLowerCase().includes(searchTerm) ||
                        user.email.toLowerCase().includes(searchTerm);
                    const matchesType = !userType || user.type === userType;
                    const matchesStatus = !statusFilter || user.status === statusFilter;

                    return matchesSearch && matchesType && matchesStatus;
                });

                // Update stats
                updateUserStats(users);

                // Display users
                displayUsers(filteredUsers);
            }

            // Demo generator removed to keep admin user list empty until real signups occur

            function updateUserStats(users) {
                const totalUsers = users.length;
                const activeUsers = users.filter(u => u.status === 'active').length;
                const writerUsers = users.filter(u => u.type === 'writer').length;
                const pendingUsers = users.filter(u => u.status === 'pending').length;

                document.getElementById('totalUsers').textContent = totalUsers;
                document.getElementById('activeUsers').textContent = activeUsers;
                document.getElementById('writerUsers').textContent = writerUsers;
                document.getElementById('pendingUsers').textContent = pendingUsers;
            }

            function displayUsers(users) {
                const tbody = document.getElementById('usersTableBody');
                const pagination = document.getElementById('pagination');

                if (users.length === 0) {
                    tbody.innerHTML = `
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 40px; color: var(--muted-text);">
                            <i class="fas fa-user-slash" style="font-size: 3rem; margin-bottom: 15px; display: block;"></i>
                            No users found matching your criteria
                        </td>
                    </tr>
                `;
                    pagination.innerHTML = '';
                    return;
                }

                // Pagination
                const itemsPerPage = 10;
                const currentPage = 1;
                const totalPages = Math.ceil(users.length / itemsPerPage);

                let html = '';
                users.slice(0, itemsPerPage).forEach(user => {
                    const joinDate = new Date(user.joined).toLocaleDateString();
                    const avatarText = user.fullName.split(' ').map(n => n[0]).join('').toUpperCase();

                    html += `
                    <tr>
                        <td>
                            <div class="user-name-cell">
                                <div class="user-avatar">${avatarText}</div>
                                <div class="user-details">
                                    <div class="name">${user.fullName}</div>
                                    <div class="email">${user.email}</div>
                                </div>
                            </div>
                        </td>
                        <td><span class="user-role">${user.type.toUpperCase()}</span></td>
                        <td><span class="user-status status-${user.status}">${user.status.toUpperCase()}</span></td>
                        <td>${joinDate}</td>
                        <td>${user.tasksCompleted}</td>
                        <td>$${user.earnings}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn view-btn" onclick="viewUser(${user.id})">
                                    <i class="fas fa-eye"></i> View
                                </button>
                                <button class="action-btn edit-btn" onclick="editUser(${user.id})">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
                });

                tbody.innerHTML = html;

                // Generate pagination
                let paginationHtml = '';
                for (let i = 1; i <= totalPages; i++) {
                    paginationHtml += `
                    <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                        ${i}
                    </button>
                `;
                }
                pagination.innerHTML = paginationHtml;
            }

            function changePage(page) {
                // Implement pagination logic
                console.log('Change to page:', page);
            }

            function viewUser(userId) {
                alert(`View user details for ID: ${userId}\nThis would open a detailed view modal.`);
            }

            function editUser(userId) {
                alert(`Edit user with ID: ${userId}\nThis would open an edit modal.`);
            }

            function exportUsers() {
                alert('Exporting users to CSV...');
                // In a real app, this would generate and download a CSV file
            }

            function logout() {
                localStorage.removeItem('neon_writers_logged_in');
                window.location.href = 'index.html';
            }
        </script>
    </body>

</html>