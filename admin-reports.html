<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Admin - Reports</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <style>
            /* Reports specific styles */
            .reports-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }

            .report-card {
                background: var(--card-bg);
                border-radius: 15px;
                padding: 25px;
                border: 1px solid rgba(138, 43, 226, 0.2);
                transition: all 0.3s;
            }

            .report-card:hover {
                transform: translateY(-5px);
                border-color: var(--neon-purple);
                box-shadow: var(--glow-purple);
            }

            .report-card h3 {
                color: var(--light-text);
                margin-bottom: 15px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .report-card p {
                color: var(--muted-text);
                margin-bottom: 20px;
                line-height: 1.6;
            }

            .report-metrics {
                display: flex;
                justify-content: space-between;
                margin-top: 20px;
                padding-top: 20px;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .metric {
                text-align: center;
            }

            .metric .value {
                font-size: 24px;
                font-weight: 700;
                color: var(--neon-green);
            }

            .metric .label {
                font-size: 12px;
                color: var(--muted-text);
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .chart-placeholder {
                height: 200px;
                background: rgba(0, 0, 0, 0.2);
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-top: 15px;
                color: var(--muted-text);
            }

            .quick-stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 15px;
                margin-bottom: 30px;
            }

            .quick-stat {
                background: var(--card-bg);
                padding: 15px;
                border-radius: 10px;
                text-align: center;
                border: 1px solid rgba(138, 43, 226, 0.1);
            }

            .quick-stat .icon {
                font-size: 24px;
                margin-bottom: 10px;
                color: var(--neon-blue);
            }

            .quick-stat .value {
                font-size: 18px;
                font-weight: 700;
                color: var(--light-text);
            }

            .quick-stat .label {
                font-size: 12px;
                color: var(--muted-text);
                margin-top: 5px;
            }

            .report-filters {
                display: flex;
                gap: 15px;
                margin-bottom: 20px;
                flex-wrap: wrap;
            }

            .period-selector {
                display: flex;
                gap: 5px;
                background: rgba(255, 255, 255, 0.1);
                border-radius: 8px;
                padding: 5px;
            }

            .period-btn {
                padding: 8px 15px;
                border-radius: 6px;
                border: none;
                background: transparent;
                color: var(--muted-text);
                cursor: pointer;
                transition: all 0.3s;
            }

            .period-btn.active {
                background: var(--gradient-primary);
                color: white;
            }

            .export-options {
                display: flex;
                gap: 10px;
                margin-top: 20px;
            }
        </style>
    </head>

    <body>
        <!-- Neon Background -->
        <div class="neon-background">
            <div class="neon-grid"></div>
        </div>

        <!-- Topbar -->
        <div class="topbar">
            <a href="mainpage.html" class="brand">
                <i class="fas fa-feather"></i> Neon Writers
            </a>

            <div class="user-menu">
                <div class="user-info">
                    <div class="user-name" id="userName">Admin Panel</div>
                    <div class="user-balance" id="userBalance">Admin</div>
                </div>
                <a href="index.html" class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>

        <!-- Main Container -->
        <div class="container">
            <!-- Sidebar -->
            <div class="sidebar">
                <ul class="nav-menu">
                    <li><a href="mainpage.html"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="admin-upload.html"><i class="fas fa-upload"></i> Upload Tasks</a></li>
                    <li><a href="admin-users.html"><i class="fas fa-users"></i> Users</a></li>
                    <li><a href="admin-bids.html"><i class="fas fa-gavel"></i> Bids Management</a></li>
                    <li><a href="admin-payments.html"><i class="fas fa-credit-card"></i> Payments</a></li>
                    <li><a href="admin-reports.html" class="active"><i class="fas fa-chart-bar"></i> Reports</a></li>
                    <li><a href="admin-settings.html"><i class="fas fa-cog"></i> Settings</a></li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="page-header">
                    <h2><i class="fas fa-chart-bar"></i> Analytics & Reports</h2>
                    <div style="font-size: 16px; color: var(--muted-text);">
                        Comprehensive analytics and performance reports
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="quick-stats">
                    <div class="quick-stat">
                        <div class="icon"><i class="fas fa-chart-line"></i></div>
                        <div class="value" id="growthRate">0%</div>
                        <div class="label">Monthly Growth</div>
                    </div>
                    <div class="quick-stat">
                        <div class="icon"><i class="fas fa-user-clock"></i></div>
                        <div class="value" id="avgCompletion">0h</div>
                        <div class="label">Avg. Completion Time</div>
                    </div>
                    <div class="quick-stat">
                        <div class="icon"><i class="fas fa-star"></i></div>
                        <div class="value" id="avgRating">0.0</div>
                        <div class="label">Avg. Writer Rating</div>
                    </div>
                    <div class="quick-stat">
                        <div class="icon"><i class="fas fa-retweet"></i></div>
                        <div class="value" id="repeatRate">0%</div>
                        <div class="label">Repeat Client Rate</div>
                    </div>
                </div>

                <!-- Period Selector -->
                <div class="report-filters">
                    <div class="period-selector">
                        <button class="period-btn active" data-period="week">This Week</button>
                        <button class="period-btn" data-period="month">This Month</button>
                        <button class="period-btn" data-period="quarter">This Quarter</button>
                        <button class="period-btn" data-period="year">This Year</button>
                    </div>
                    <input type="date" class="date-input" id="customStart">
                    <input type="date" class="date-input" id="customEnd">
                    <button class="btn btn-secondary" onclick="applyCustomRange()">
                        <i class="fas fa-calendar-alt"></i> Apply Range
                    </button>
                </div>

                <!-- Reports Grid -->
                <div class="reports-grid">
                    <div class="report-card">
                        <h3><i class="fas fa-money-bill-wave"></i> Revenue Report</h3>
                        <p>Total revenue generated from all tasks and services</p>
                        <div class="chart-placeholder">
                            <div style="text-align: center;">
                                <i class="fas fa-chart-line"
                                    style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                Revenue Chart
                            </div>
                        </div>
                        <div class="report-metrics">
                            <div class="metric">
                                <div class="value" id="revenueTotal">$0</div>
                                <div class="label">Total</div>
                            </div>
                            <div class="metric">
                                <div class="value" id="revenueGrowth">0%</div>
                                <div class="label">Growth</div>
                            </div>
                            <div class="metric">
                                <div class="value" id="revenueAvg">$0</div>
                                <div class="label">Avg/Day</div>
                            </div>
                        </div>
                    </div>

                    <div class="report-card">
                        <h3><i class="fas fa-tasks"></i> Tasks Report</h3>
                        <p>Performance metrics for all tasks and assignments</p>
                        <div class="chart-placeholder">
                            <div style="text-align: center;">
                                <i class="fas fa-chart-pie"
                                    style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                Tasks Distribution
                            </div>
                        </div>
                        <div class="report-metrics">
                            <div class="metric">
                                <div class="value" id="tasksCompleted">0</div>
                                <div class="label">Completed</div>
                            </div>
                            <div class="metric">
                                <div class="value" id="tasksActive">0</div>
                                <div class="label">Active</div>
                            </div>
                            <div class="metric">
                                <div class="value" id="tasksAvgTime">0h</div>
                                <div class="label">Avg. Time</div>
                            </div>
                        </div>
                    </div>

                    <div class="report-card">
                        <h3><i class="fas fa-users"></i> Users Report</h3>
                        <p>User acquisition, retention, and activity metrics</p>
                        <div class="chart-placeholder">
                            <div style="text-align: center;">
                                <i class="fas fa-chart-bar"
                                    style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                User Analytics
                            </div>
                        </div>
                        <div class="report-metrics">
                            <div class="metric">
                                <div class="value" id="newUsers">0</div>
                                <div class="label">New Users</div>
                            </div>
                            <div class="metric">
                                <div class="value" id="activeUsers">0</div>
                                <div class="label">Active</div>
                            </div>
                            <div class="metric">
                                <div class="value" id="retentionRate">0%</div>
                                <div class="label">Retention</div>
                            </div>
                        </div>
                    </div>

                    <div class="report-card">
                        <h3><i class="fas fa-gavel"></i> Bids Report</h3>
                        <p>Bidding patterns, success rates, and writer performance</p>
                        <div class="chart-placeholder">
                            <div style="text-align: center;">
                                <i class="fas fa-chart-area"
                                    style="font-size: 2rem; margin-bottom: 10px; display: block;"></i>
                                Bids Analytics
                            </div>
                        </div>
                        <div class="report-metrics">
                            <div class="metric">
                                <div class="value" id="totalBids">0</div>
                                <div class="label">Total Bids</div>
                            </div>
                            <div class="metric">
                                <div class="value" id="successRate">0%</div>
                                <div class="label">Success Rate</div>
                            </div>
                            <div class="metric">
                                <div class="value" id="avgBidAmount">$0</div>
                                <div class="label">Avg. Bid</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Export Options -->
                <div class="export-options">
                    <button class="btn btn-primary" onclick="generateReport('summary')">
                        <i class="fas fa-file-alt"></i> Generate Summary Report
                    </button>
                    <button class="btn btn-secondary" onclick="generateReport('detailed')">
                        <i class="fas fa-file-excel"></i> Detailed Report (Excel)
                    </button>
                    <button class="btn btn-secondary" onclick="generateReport('pdf')">
                        <i class="fas fa-file-pdf"></i> Export as PDF
                    </button>
                </div>
            </div>
        </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                checkAdminAuth();
                loadReportData();

                // Period selector
                document.querySelectorAll('.period-btn').forEach(btn => {
                    btn.addEventListener('click', function () {
                        document.querySelectorAll('.period-btn').forEach(b => b.classList.remove('active'));
                        this.classList.add('active');
                        loadReportData(this.dataset.period);
                    });
                });

                document.getElementById('logoutBtn').addEventListener('click', logout);

                // Set default dates
                const endDate = new Date();
                const startDate = new Date();
                startDate.setDate(startDate.getDate() - 7); // Default to last week

                document.getElementById('customStart').value = startDate.toISOString().split('T')[0];
                document.getElementById('customEnd').value = endDate.toISOString().split('T')[0];
            });

            function checkAdminAuth() {
                const isLoggedIn = localStorage.getItem('neon_writers_logged_in') === 'true';
                if (!isLoggedIn) {
                    window.location.href = 'login.html';
                    return;
                }

                const userData = JSON.parse(localStorage.getItem('neon_writers_user') || '{}');
                const isAdmin = userData.email && (userData.email.includes('admin') || userData.isAdmin === true);

                if (!isAdmin) {
                    alert('Access Denied: Admin privileges required');
                    window.location.href = 'mainpage.html';
                    return;
                }

                document.getElementById('userName').textContent = `Admin: ${userData.firstName || 'Administrator'}`;
            }

            function loadReportData(period = 'week') {
                // Get data from localStorage
                const tasks = JSON.parse(localStorage.getItem('neon_writers_tasks') || '[]');
                const bids = JSON.parse(localStorage.getItem('neon_writers_user_bids') || '[]');
                const users = JSON.parse(localStorage.getItem('neon_writers_users') || '[]');
                const payments = JSON.parse(localStorage.getItem('neon_writers_payments') || '[]');

                // Calculate date range based on period
                const endDate = new Date();
                let startDate = new Date();

                switch (period) {
                    case 'week':
                        startDate.setDate(startDate.getDate() - 7);
                        break;
                    case 'month':
                        startDate.setMonth(startDate.getMonth() - 1);
                        break;
                    case 'quarter':
                        startDate.setMonth(startDate.getMonth() - 3);
                        break;
                    case 'year':
                        startDate.setFullYear(startDate.getFullYear() - 1);
                        break;
                }

                // Filter data by date range
                const filteredTasks = tasks.filter(task =>
                    new Date(task.createdAt) >= startDate && new Date(task.createdAt) <= endDate
                );

                const filteredBids = bids.filter(bid =>
                    new Date(bid.submittedDate) >= startDate && new Date(bid.submittedDate) <= endDate
                );

                const filteredPayments = payments.filter(payment =>
                    new Date(payment.date) >= startDate && new Date(payment.date) <= endDate
                );

                // Calculate metrics
                const revenueTotal = filteredPayments.reduce((sum, p) => sum + p.amount, 0);
                const tasksCompleted = filteredTasks.filter(t => t.status === 'completed').length;
                const tasksActive = filteredTasks.filter(t => t.status === 'in-progress').length;
                const newUsers = users.filter(u =>
                    new Date(u.joined) >= startDate && new Date(u.joined) <= endDate
                ).length;

                // Update UI
                document.getElementById('revenueTotal').textContent = `$${revenueTotal.toFixed(2)}`;
                document.getElementById('tasksCompleted').textContent = tasksCompleted;
                document.getElementById('tasksActive').textContent = tasksActive;
                document.getElementById('newUsers').textContent = newUsers;
                document.getElementById('totalBids').textContent = filteredBids.length;

                // Calculate additional metrics
                const growthRate = calculateGrowthRate(payments, period);
                const successRate = bids.length > 0 ?
                    Math.round((bids.filter(b => b.status === 'approved').length / bids.length) * 100) : 0;
                const avgBidAmount = bids.length > 0 ?
                    bids.reduce((sum, b) => sum + parseFloat(b.bidAmount), 0) / bids.length : 0;

                document.getElementById('growthRate').textContent = `${growthRate}%`;
                document.getElementById('successRate').textContent = `${successRate}%`;
                document.getElementById('avgBidAmount').textContent = `$${avgBidAmount.toFixed(2)}`;

                // Demo data for other metrics
                document.getElementById('revenueGrowth').textContent = `${Math.floor(Math.random() * 20) + 5}%`;
                document.getElementById('revenueAvg').textContent = `$${(revenueTotal / 30).toFixed(2)}`;
                document.getElementById('tasksAvgTime').textContent = `${Math.floor(Math.random() * 24) + 1}h`;
                document.getElementById('activeUsers').textContent = Math.floor(Math.random() * 50) + 10;
                document.getElementById('retentionRate').textContent = `${Math.floor(Math.random() * 30) + 60}%`;
                document.getElementById('avgCompletion').textContent = `${Math.floor(Math.random() * 48) + 12}h`;
                document.getElementById('avgRating').textContent = `${(Math.random() * 2 + 3).toFixed(1)}`;
                document.getElementById('repeatRate').textContent = `${Math.floor(Math.random() * 40) + 40}%`;
            }

            function calculateGrowthRate(payments, period) {
                if (payments.length < 2) return 0;

                const now = new Date();
                let previousStart, previousEnd;

                switch (period) {
                    case 'week':
                        previousEnd = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);
                        previousStart = new Date(previousEnd.getTime() - 7 * 24 * 60 * 60 * 1000);
                        break;
                    case 'month':
                        previousEnd = new Date(now.getFullYear(), now.getMonth() - 1, now.getDate());
                        previousStart = new Date(previousEnd.getFullYear(), previousEnd.getMonth() - 1, previousEnd.getDate());
                        break;
                    default:
                        return Math.floor(Math.random() * 20) + 5; // Demo data
                }

                const currentRevenue = payments.filter(p =>
                    new Date(p.date) >= previousEnd && new Date(p.date) <= now
                ).reduce((sum, p) => sum + p.amount, 0);

                const previousRevenue = payments.filter(p =>
                    new Date(p.date) >= previousStart && new Date(p.date) <= previousEnd
                ).reduce((sum, p) => sum + p.amount, 0);

                if (previousRevenue === 0) return 100;
                return Math.round(((currentRevenue - previousRevenue) / previousRevenue) * 100);
            }

            function applyCustomRange() {
                const startDate = document.getElementById('customStart').value;
                const endDate = document.getElementById('customEnd').value;

                if (!startDate || !endDate) {
                    alert('Please select both start and end dates');
                    return;
                }

                if (new Date(startDate) > new Date(endDate)) {
                    alert('Start date cannot be after end date');
                    return;
                }

                // Update active period button
                document.querySelectorAll('.period-btn').forEach(btn => btn.classList.remove('active'));

                // Load data for custom range
                loadCustomRangeData(startDate, endDate);
            }

            function loadCustomRangeData(startDate, endDate) {
                // Similar to loadReportData but with custom dates
                alert(`Loading data for custom range: ${startDate} to ${endDate}`);

                // For demo purposes, just reload with week data
                loadReportData('week');
            }

            function generateReport(type) {
                const reportTypes = {
                    'summary': 'Summary Report',
                    'detailed': 'Detailed Excel Report',
                    'pdf': 'PDF Report'
                };

                alert(`Generating ${reportTypes[type]}...\n\nIn a real application, this would:\n1. Collect all data\n2. Format it according to the report type\n3. Generate and download the file`);

                // Demo: Show a success message
                setTimeout(() => {
                    alert(`${reportTypes[type]} generated successfully!\nA download would start automatically.`);
                }, 1000);
            }

            function logout() {
                localStorage.removeItem('neon_writers_logged_in');
                window.location.href = 'index.html';
            }
        </script>
    </body>

</html>