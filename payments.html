<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Payments - Surveys & Tasks</title>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            }

            body {
                background-color: #f5f7fa;
                color: #333;
            }

            /* Topbar */
            .topbar {
                background: white;
                padding: 15px 30px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
                position: sticky;
                top: 0;
                z-index: 100;
            }

            .logo {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .logo h1 {
                font-size: 24px;
                color: #1e3c72;
            }

            .logo i {
                color: #4dabf7;
            }

            .user-info {
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .notification-bell {
                position: relative;
                font-size: 18px;
                color: #5a6c7d;
                cursor: pointer;
            }

            .notification-badge {
                position: absolute;
                top: -5px;
                right: -5px;
                background-color: #f03e3e;
                color: white;
                font-size: 11px;
                width: 18px;
                height: 18px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .user-profile {
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .user-avatar {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                background-color: #4dabf7;
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-weight: bold;
            }

            /* Main container */
            .container {
                display: flex;
                min-height: calc(100vh - 70px);
            }

            /* Sidebar */
            .sidebar {
                width: 250px;
                background: linear-gradient(180deg, #1e3c72 0%, #2a5298 100%);
                color: white;
                padding: 30px 0;
                display: flex;
                flex-direction: column;
            }

            .nav-menu {
                list-style: none;
                flex-grow: 1;
            }

            .nav-menu li {
                margin-bottom: 5px;
            }

            .nav-menu a {
                display: flex;
                align-items: center;
                padding: 15px 25px;
                color: #d0d7e7;
                text-decoration: none;
                font-size: 16px;
                font-weight: 500;
                transition: all 0.3s;
                border-left: 4px solid transparent;
            }

            .nav-menu a:hover {
                background-color: rgba(255, 255, 255, 0.08);
                color: white;
                border-left-color: #4dabf7;
            }

            .nav-menu a.active {
                background-color: rgba(77, 171, 247, 0.15);
                color: white;
                border-left-color: #4dabf7;
            }

            .nav-menu i {
                margin-right: 12px;
                font-size: 18px;
                width: 24px;
                text-align: center;
            }

            /* Main content */
            .main-content {
                flex-grow: 1;
                padding: 30px;
                overflow-y: auto;
            }

            .page-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 30px;
                padding-bottom: 15px;
                border-bottom: 1px solid #e1e5eb;
            }

            .page-header h2 {
                font-size: 28px;
                color: #1e3c72;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .page-header h2 i {
                color: #4dabf7;
            }

            /* Payment stats */
            .payment-stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 25px;
                margin-bottom: 40px;
            }

            .stat-card {
                background-color: white;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                padding: 25px;
                display: flex;
                align-items: center;
                gap: 20px;
            }

            .stat-icon {
                width: 60px;
                height: 60px;
                border-radius: 10px;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 24px;
                color: white;
            }

            .stat-icon.blue {
                background-color: #4dabf7;
            }

            .stat-icon.green {
                background-color: #40c057;
            }

            .stat-icon.orange {
                background-color: #fd7e14;
            }

            .stat-icon.purple {
                background-color: #be4bdb;
            }

            .stat-details h3 {
                font-size: 14px;
                color: #6c757d;
                margin-bottom: 5px;
            }

            .stat-details .amount {
                font-size: 28px;
                font-weight: 700;
                color: #1e3c72;
            }

            .stat-details .change {
                font-size: 13px;
                margin-top: 5px;
            }

            .change.positive {
                color: #40c057;
            }

            .change.negative {
                color: #fa5252;
            }

            /* Withdrawal section */
            .withdrawal-section {
                background-color: white;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
                padding: 30px;
                margin-bottom: 40px;
            }

            .section-title {
                font-size: 20px;
                color: #1e3c72;
                margin-bottom: 20px;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .section-title i {
                color: #4dabf7;
            }

            .withdrawal-form {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
                margin-bottom: 25px;
            }

            .form-group {
                display: flex;
                flex-direction: column;
            }

            .form-group label {
                font-weight: 600;
                margin-bottom: 8px;
                color: #495057;
            }

            .form-group select,
            .form-group input {
                padding: 12px 15px;
                border: 1px solid #ddd;
                border-radius: 8px;
                font-size: 16px;
            }

            .form-group input::placeholder {
                color: #1a1b1b;
            }

            .btn {
                padding: 12px 25px;
                border-radius: 6px;
                border: none;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                font-size: 16px;
            }

            .btn-primary {
                background-color: #4dabf7;
                color: white;
            }

            .btn-primary:hover {
                background-color: #339af0;
            }

            .btn-secondary {
                background-color: #e9ecef;
                color: #495057;
            }

            .btn-secondary:hover {
                background-color: #dee2e6;
            }

            /* Payment history */
            table {
                width: 100%;
                border-collapse: collapse;
                background-color: white;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            }

            th {
                text-align: left;
                padding: 18px 20px;
                background-color: #f8f9fa;
                color: #495057;
                font-weight: 600;
                border-bottom: 2px solid #e9ecef;
            }

            td {
                padding: 16px 20px;
                border-bottom: 1px solid #e9ecef;
                color: #5a6c7d;
            }

            tr:hover {
                background-color: #f8f9fa;
            }

            .status {
                padding: 6px 12px;
                border-radius: 20px;
                font-size: 13px;
                font-weight: 600;
            }

            .status.completed {
                background-color: #d4edda;
                color: #155724;
            }

            .status.pending {
                background-color: #fff3cd;
                color: #856404;
            }

            .status.processing {
                background-color: #cce5ff;
                color: #004085;
            }

            .amount-cell {
                font-weight: 600;
                color: #1e3c72;
            }

            .payment-method {
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .payment-method i {
                color: #4dabf7;
            }

            /* Responsive */
            @media (max-width: 992px) {
                .sidebar {
                    width: 220px;
                }
            }

            @media (max-width: 768px) {
                .container {
                    flex-direction: column;
                }

                .sidebar {
                    width: 100%;
                    padding: 15px 0;
                }

                .nav-menu {
                    display: flex;
                    overflow-x: auto;
                    padding: 0 15px;
                }

                .nav-menu li {
                    flex-shrink: 0;
                    margin-bottom: 0;
                }

                .nav-menu a {
                    padding: 12px 15px;
                    border-left: none;
                    border-bottom: 3px solid transparent;
                }

                .nav-menu a.active {
                    border-left: none;
                    border-bottom-color: #4dabf7;
                }

                table {
                    display: block;
                    overflow-x: auto;
                }
            }
        </style>
    </head>

    <body>
        <!-- Topbar -->
        <div class="topbar">
            <a href="mainpage.html" class="brand">
                <i class="fas fa-feather"></i> Neon Writers
            </a>

            <div class="user-menu">
                <div class="user-info">
                    <div class="user-name" id="userName">Loading...</div>
                    <div class="user-balance" id="userBalance">KES 0</div>
                </div>
                <a href="index.html" class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </a>
            </div>
        </div>

        <!-- Main Container -->
        <div class="container">
            <!-- Sidebar -->
            <div class="sidebar">
                <ul class="nav-menu">
                    <li><a href="mainpage.html"><i class="fas fa-home"></i> Dashboard</a></li>
                    <!-- <li><a href="surveys.html"><i class="fas fa-list-alt"></i> Surveys</a></li> -->
                    <li><a href="payments.html" class="active"><i class="fas fa-credit-card"></i> Payments</a></li>
                    <li><a href="my-bids.html"><i class="fas fa-gavel"></i> My Bids</a></li>
                    <li><a href="assigned-tasks.html"><i class="fas fa-clipboard-list"></i> Assigned Tasks</a></li>
                    <li><a href="completed.html"><i class="fas fa-check-circle"></i> Completed</a></li>
                    <li><a href="support.html"><i class="fas fa-headset"></i> Support</a></li>
                    <li><a href="profile.html"><i class="fas fa-user"></i> My Profile</a></li>
                </ul>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <div class="page-header">
                    <h2><i class="fas fa-credit-card"></i> Payments & Withdrawals</h2>
                    <div style="font-size: 16px; color: #6c757d;">
                        Next payout: <strong>Jun 30, 2023</strong>
                    </div>
                </div>

                <!-- Payment Statistics -->
                <div class="payment-stats">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-wallet"></i>
                        </div>
                        <div class="stat-details">
                            <h3>Available Balance</h3>
                            <div class="amount" id="availableAmount">$0.00</div>
                            <div class="change positive" id="availableChange">+$0.00 this month</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-money-check-alt"></i>
                        </div>
                        <div class="stat-details">
                            <h3>Total Earned</h3>
                            <div class="amount" id="totalEarnedAmount">$0.00</div>
                            <div class="change positive">All time</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-details">
                            <h3>Pending Payment</h3>
                            <div class="amount" id="pendingAmount">$0.00</div>
                            <div class="change positive" id="pendingCount">0 tasks pending</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon purple">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div class="stat-details">
                            <h3>This Month</h3>
                            <div class="amount" id="thisMonthAmount">$0.00</div>
                            <div class="change positive">+0% from last month</div>
                        </div>
                    </div>
                </div>

                <!-- Withdrawal Section -->
                <div class="withdrawal-section">
                    <div class="section-title">
                        <i class="fas fa-hand-holding-usd"></i> Withdraw Funds
                    </div>

                    <div class="withdrawal-form">
                        <div class="form-group">
                            <label for="withdrawal-method">Payment Method</label>
                            <select id="withdrawal-method">
                                <option value="paypal">PayPal</option>
                                <option value="bank">Bank Transfer</option>
                                <option value="skrill">Skrill</option>
                                <option value="payoneer">Payoneer</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="withdrawal-amount">Amount ($)</label>
                            <input type="number" id="withdrawal-amount" placeholder="0.00" min="0" value="0.00">
                        </div>

                        <div class="form-group">
                            <label for="account-details">Account Details</label>
                            <input type="text" id="account-details" placeholder="john.doe@example.com">
                        </div>
                    </div>

                    <div style="display: flex; gap: 15px;">
                        <button class="btn btn-primary">Request Withdrawal</button>
                        <button class="btn btn-secondary">Add Payment Method</button>
                    </div>

                    <div style="margin-top: 20px; font-size: 14px; color: #6c757d;">
                        <p><i class="fas fa-info-circle" style="color: #4dabf7; margin-right: 8px;"></i> Minimum
                            withdrawal amount: $10.00. Processing time: 3-5 business days.</p>
                    </div>
                </div>

                <!-- Payment History -->
                <div style="margin-top: 40px;">
                    <div class="section-title">
                        <i class="fas fa-history"></i> Payment History
                    </div>

                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Method</th>
                                <th>Amount</th>
                                <th>Status</th>
                                <th>Reference</th>
                            </tr>
                        </thead>
                        <tbody id="paymentsTableBody">
                            <!-- Populated from localStorage (neon_writers_payments) -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <script>
            // Payment page functionality
            document.addEventListener('DOMContentLoaded', function () {
                // Load user balance and update displayed amounts
                const userData = JSON.parse(localStorage.getItem('neon_writers_user') || '{}');
                const availableBalance = parseFloat(userData.balance) || 0;
                const totalEarned = parseFloat(userData.totalEarned) || 0;

                // Update stat displays
                const availableElem = document.getElementById('availableAmount');
                const totalEarnedElem = document.getElementById('totalEarnedAmount');
                const pendingElem = document.getElementById('pendingAmount');
                const thisMonthElem = document.getElementById('thisMonthAmount');

                if (availableElem) availableElem.textContent = `$${availableBalance.toFixed(2)}`;
                if (totalEarnedElem) totalEarnedElem.textContent = `$${totalEarned.toFixed(2)}`;
                if (pendingElem) pendingElem.textContent = `$0.00`;
                if (thisMonthElem) thisMonthElem.textContent = `$0.00`;
                // Withdrawal form submission
                const withdrawalBtn = document.querySelector('.btn-primary');
                const amountInput = document.getElementById('withdrawal-amount');
                const methodSelect = document.getElementById('withdrawal-method');

                withdrawalBtn.addEventListener('click', function () {
                    const amount = parseFloat(amountInput.value) || 0;
                    const method = methodSelect.options[methodSelect.selectedIndex].text;
                    const userData = JSON.parse(localStorage.getItem('neon_writers_user') || '{}');
                    const availableBalance = parseFloat(userData.balance) || 0;

                    // Populate payment history from localStorage; show clean message if none
                    function loadPayments() {
                        localStorage.removeItem('neon_writers_payments'); // For testing purposes
                        const payments = JSON.parse(localStorage.getItem('neon_writers_payments') || '[]');
                        const tbody = document.getElementById('paymentsTableBody');
                        if (!tbody) return;

                        if (!payments || payments.length === 0) {
                            tbody.innerHTML = `
                                <tr>
                                    <td colspan="6" style="text-align:center; padding:40px; color:#6c757d;">
                                        <i class="fas fa-history" style="font-size:2rem; display:block; margin-bottom:12px;"></i>
                                        No payment history yet
                                    </td>
                                </tr>
                            `;
                            return;
                        }

                        let html = '';
                        payments.forEach(p => {
                            const date = p.date || new Date().toLocaleDateString();
                            const desc = p.description || '';
                            const methodHtml = `<div class="payment-method">${p.methodIcon ? '<i class="' + p.methodIcon + '"></i>' : '<i class="fab fa-paypal"></i>'} ${p.method || ''}</div>`;
                            const amount = typeof p.amount === 'number' ? `$${p.amount.toFixed(2)}` : `$${parseFloat(p.amount || 0).toFixed(2)}`;
                            const status = p.status || 'Completed';
                            const statusClass = `status ${status.toLowerCase()}`;
                            const ref = p.reference || '';

                            html += `
                                <tr>
                                    <td>${date}</td>
                                    <td>${desc}</td>
                                    <td>${methodHtml}</td>
                                    <td class="amount-cell">${amount}</td>
                                    <td><span class="${statusClass}">${status}</span></td>
                                    <td>${ref}</td>
                                </tr>
                            `;
                        });

                        tbody.innerHTML = html;
                    }

                    loadPayments();

                    if (amount < 10) {
                        alert('Minimum withdrawal amount is $10.00');
                        return;
                    }

                    if (amount > availableBalance) {
                        alert(`Insufficient balance. Available balance: $${availableBalance.toFixed(2)}`);
                        return;
                    }

                    alert(`Withdrawal request for $${amount.toFixed(2)} via ${method} submitted successfully! You will receive your funds within 3-5 business days.`);

                    // Reset form
                    amountInput.value = '0.00';
                });

                // Add payment method button
                const addMethodBtn = document.querySelector('.btn-secondary');
                addMethodBtn.addEventListener('click', function () {
                    alert('Redirecting to payment method setup page...');
                });
            });
        </script>
        <script src="validate.js"></script>
    </body>

</html>